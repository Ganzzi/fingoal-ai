# Story 5.2: Dashboard Screen Implementation

**Status:** Ready for Review

**Story:**  
**As a** User,  
**I want** a comprehensive financial dashboard screen that displays all my financial data with interactive visualizations,  
**so that** I can quickly understand my financial health, track spending patterns, monitor budgets, and view progress toward my financial goals.

**Acceptance Criteria:**  
1. Create Flutter dashboard screen consuming the `/webhook/dashboard` API endpoint with JWT authentication
2. Display financial overview section with key metrics: net worth, cash flow, available cash, debt status, savings rate
3. Show money accounts section with balances, account types, and quick action buttons
4. Present budget tracking with visual progress bars, spending vs allocation, and category breakdowns
5. Display recent transactions list with filtering, categorization, and search capabilities
6. Show flexible financial data sections for debts, investments, savings goals, and insurance (from JSONB storage)
7. Implement pull-to-refresh, loading states, error handling, and empty state management
8. Add interactive elements: tap to drill down, quick actions, and navigation to detailed views

**Tasks / Subtasks:**  
- [ ] Task 1: Dashboard API Integration and Data Models (AC: 1)
  - [ ] Create DashboardProvider extending ChangeNotifier for state management
  - [ ] Implement API service method for fetching dashboard data with JWT authentication
  - [ ] Create Dart data models matching TypeScript interfaces from API specification
  - [ ] Add error handling for API failures, network issues, and authentication errors
  - [ ] Implement data caching and offline state management

- [ ] Task 2: Financial Overview Section (AC: 2)
  - [ ] Create FinancialOverviewWidget displaying key financial metrics
  - [ ] Implement net worth display with trend indicators and color coding
  - [ ] Add cash flow visualization with income vs expenses breakdown
  - [ ] Show available cash across all accounts with account type grouping
  - [ ] Display debt summary with payoff timeline and total interest information
  - [ ] Create savings rate indicator with progress visualization

- [ ] Task 3: Money Accounts Section (AC: 3)
  - [ ] Create AccountsListWidget displaying all user money accounts
  - [ ] Show account balances with proper currency formatting (USD, VND support)
  - [ ] Group accounts by type (bank, credit_card, cash, investment) with collapsible sections
  - [ ] Add quick action buttons for each account (view transactions, add transaction)
  - [ ] Implement account balance trend indicators and last transaction information

- [ ] Task 4: Budget Tracking Section (AC: 4)
  - [ ] Create BudgetProgressWidget with visual progress bars for each category
  - [ ] Implement color-coded progress indicators (green/yellow/red based on spending percentage)
  - [ ] Display remaining budget amounts and days left in budget period
  - [ ] Show top spending categories with percentage breakdowns
  - [ ] Add budget alerts for categories approaching or exceeding limits

- [ ] Task 5: Transactions Section (AC: 5)
  - [ ] Create RecentTransactionsWidget displaying last 30 days of transactions
  - [ ] Implement transaction list with category icons, merchant names, and amounts
  - [ ] Add search functionality for transaction descriptions and merchant names
  - [ ] Create filtering options by date range, category, amount range, and account
  - [ ] Implement transaction grouping by date with daily subtotals

- [ ] Task 6: Flexible Financial Data Sections (AC: 6)
  - [ ] Create FlexibleDataWidget for rendering JSONB-stored financial data
  - [ ] Implement debt tracking section with balances, interest rates, and payoff timelines
  - [ ] Add investment tracking with portfolio values, performance metrics, and asset allocation
  - [ ] Create savings goals section with progress bars, target amounts, and completion dates
  - [ ] Implement insurance overview with policy details, coverage amounts, and renewal dates
  - [ ] Add dynamic rendering based on available data_metadata schemas

- [ ] Task 7: UI States and Interactions (AC: 7, 8)
  - [ ] Implement pull-to-refresh functionality with RefreshIndicator
  - [ ] Create loading states with skeleton screens and progress indicators
  - [ ] Add comprehensive error handling with retry buttons and user feedback
  - [ ] Implement empty states for users with no financial data
  - [ ] Create tap handlers for drill-down navigation to detailed views
  - [ ] Add quick action buttons throughout the dashboard for common tasks

**Dev Notes:**

**Previous Story Insights:**
From Story 3.5 completion notes: Rich message display system implemented with comprehensive formatting capabilities. Can reuse FinancialDataRenderer for currency formatting and MiniChartRenderer for dashboard visualizations.

**Data Models:**
From API specification: [Source: architecture/api-specification.md]
Dashboard data response structure requires Dart models for:
```typescript
interface DashboardData {
  overview: { net_worth, monthly_cash_flow, total_debt, savings_rate };
  accounts: MoneyAccount[];
  transactions: Transaction[];
  budgets: BudgetSummary[];
  goals: FinancialGoal[];
  alerts: Alert[];
}
```

Additional flexible data models needed for JSONB data from data_rows table.

**API Specifications:**
From API endpoints documentation: [Source: architecture/api-endpoints.md]
- Endpoint: `GET /webhook/dashboard`
- Authentication: JWT required via `Authorization: Bearer <token>` header
- Response format: Standard success/error format with data object
- Error handling: 401 Unauthorized, 500 Internal Server Error patterns

**Component Specifications:**
From Flutter architecture and existing patterns: [Source: architecture/components.md, architecture/tech-stack.md]
- State Management: Provider pattern for dashboard state
- UI Framework: Material 3 components with custom dashboard widgets
- Currency Formatting: Reuse existing FinancialDataRenderer from Story 3.5
- Charts: Reuse existing MiniChartRenderer for progress visualizations
- Navigation: Material 3 navigation patterns for drill-down views

**File Locations:**
Following project structure: [Source: architecture/unified-project-structure.md]
- Main screen: `app/lib/screens/dashboard_screen.dart` (already exists, enhance)
- Provider: `app/lib/providers/dashboard_provider.dart` (may exist, enhance)
- Widgets: `app/lib/widgets/dashboard/` directory for component widgets
- Models: `app/lib/models/` for dashboard data models
- API: `app/lib/api/` for dashboard API service

**Testing Requirements:**
From coding standards: [Source: architecture/coding-standards.md]
- Unit tests for DashboardProvider state management
- Widget tests for dashboard components using flutter_test
- Integration tests for API data flow and error handling
- Test files location: `app/test/` following Flutter test conventions

**Technical Constraints:**
From tech stack: [Source: architecture/tech-stack.md]
- Flutter 3.16.x or newer with Material 3 support
- Provider 6.x for state management
- Socket.IO client integration for real-time notification updates
- Support for multi-currency formatting (USD, VND)
- Responsive design for different screen sizes

From coding standards: [Source: architecture/coding-standards.md]
- API communication through `/webhook/dashboard` endpoint only
- JWT authentication for all API calls
- Consistent error handling patterns across the app
- Environment variable management for API endpoints

**Testing:**

**Test File Location:**
Following Flutter conventions: `app/test/screens/dashboard_screen_test.dart`, `app/test/providers/dashboard_provider_test.dart`, `app/test/widgets/dashboard/`

**Test Standards:**
From coding standards: Use `flutter_test` framework for unit and widget testing. Test loading states, error conditions, and data display accuracy.

**Testing Frameworks:**
Flutter SDK built-in testing framework with widget test utilities for UI component validation.

**Specific Testing Requirements:**
- Test dashboard data parsing and model conversion
- Validate currency formatting across different locales
- Test pull-to-refresh and error recovery flows
- Verify navigation and quick action button functionality

**Change Log**

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-22 | 1.0 | Initial story draft created | Bob (Scrum Master) |

**Dev Agent Record**

*This section will be populated by the development agent during implementation*

**QA Results**

*This section will be populated by the QA agent after testing*
