# Story 2.7: Educate Customer Agent

## Status
Ready for Review

## Story
**As a** User,
**I want** to receive clear explanations of financial concepts tailored to my understanding level,
**so that** I can make informed decisions and improve my financial literacy.

## Acceptance Criteria
1. ✅ An n8n workflow named "Educate Customer Agent" is created.
2. ✅ Triggered by Orchestrator Agent for "ask_question" intents or as supplementary content.
3. ✅ Provides financial literacy guidance and concept explanations:
   - Basic financial concepts (interest, inflation, diversification)
   - Investment explanations with examples
   - Tax implications and strategies
   - Insurance types and coverage needs
4. ✅ Personalizes educational content based on user's profile and experience level.
5. ✅ Uses user's actual financial situation for relevant examples and context.
6. ✅ Returns educational content with explanations, examples, and optional quizzes.
7. ✅ Tracks educational progress in memory to avoid repetition and build on knowledge.
8. ✅ **Reference:** Follow patterns in `docs/n8n_config_creation_instructions/ai-agent-chat-api-workflow-example.md`

## Tasks / Subtasks

### Task 1: Create Financial Education Workflow (AC: 1, 2)
- [x] Create new n8n workflow named "Educate Customer Agent"
- [x] Add executeWorkflowTrigger node to receive input from Orchestrator Agent
- [x] Configure input validation for educational requests and question types
- [x] Set up topic routing (basic concepts, investments, taxes, insurance, planning)
- [x] Add user authentication and education profile access
- [x] Configure error handling for unclear or out-of-scope educational requests

### Task 2: Implement Topic Classification and Content Selection (AC: 3)
- [x] Add AI Agent node for educational topic analysis and classification
- [x] Configure topic detection for financial education categories:
  - Basic concepts (budgeting, saving, compound interest, inflation)
  - Investment education (stocks, bonds, ETFs, mutual funds, risk/return)
  - Tax planning (deductions, tax-advantaged accounts, strategies)
  - Insurance education (types, coverage needs, cost-benefit analysis)
  - Financial planning (goal setting, emergency funds, retirement)
- [x] Set up complexity level detection based on user question sophistication
- [x] Add prerequisite topic identification for learning progression

### Task 3: Retrieve User Context and Education Profile (AC: 4, 5)
- [x] Add PostgreSQL nodes to query user's financial profile and education history:
  - Current financial situation (income, assets, goals) for personalized examples
  - Previous educational interactions and completed topics from memories
  - User's demonstrated knowledge level and preferred learning style
  - Recent financial decisions and advice received for context
- [x] Query user preferences for educational content (detailed vs. simple, examples vs. theory)
- [x] Access current financial plans and goals to provide relevant education

### Task 4: Configure Personalized Content Generation (AC: 4, 5, 6)
- [x] Add AI Agent node (Google Gemini) specialized for financial education
- [x] Configure system prompt for certified financial educator expertise
- [x] Implement adaptive content generation based on user profile:
  - Beginner level: Simple explanations, basic examples, step-by-step guidance
  - Intermediate level: More detail, comparative analysis, strategic considerations
  - Advanced level: Complex concepts, tax optimization, sophisticated strategies
- [x] Generate personalized examples using user's actual financial data
- [x] Create interactive elements (thought exercises, scenario analysis, decision trees)

### Task 5: Implement Learning Progression and Knowledge Building (AC: 7)
- [x] Add logic for educational prerequisite checking and learning path guidance
- [x] Configure knowledge gap identification and foundational topic recommendations
- [x] Set up progress tracking for multi-session learning objectives
- [x] Implement spaced repetition for important concepts and review scheduling
- [x] Add knowledge assessment through contextual questions and scenario responses
- [x] Generate follow-up topic suggestions based on current learning and financial situation

### Task 6: Create Interactive Educational Content (AC: 6)
- [x] Add content formatting for explanations with examples and practical applications
- [x] Configure scenario-based learning with user's financial situation
- [x] Generate optional quiz questions and knowledge check activities
- [x] Create decision-making frameworks and step-by-step guides
- [x] Add calculators and tools for hands-on financial concept application
- [x] Format content with visual aids (text charts, comparison tables, timelines)

### Task 7: Configure Educational Output and Memory Management (AC: 6, 7)
- [x] Add Structured Output Parser for educational content delivery
- [x] Configure output schema for lessons, examples, quizzes, and progress tracking
- [x] Format educational summaries with key takeaways and action items
- [x] Generate memory updates for education progress and user knowledge tracking
- [x] Store query-specific examples and user interaction patterns
- [x] Update educational preferences and preferred learning topics

## Dev Notes

### Architecture Requirements
[Source: architecture/tech-stack.md]
- **Backend Platform:** n8n Cloud/n8n latest version with advanced AI educational capabilities
- **Database:** PostgreSQL 15 or 16 for education progress tracking and content personalization
- **AI Integration:** Google Gemini for sophisticated educational content generation and adaptation
- **Content Engine:** Dynamic educational content creation with personalization and progression

### Educational Input Specification
[Source: architecture/api-specification.md]
**Triggered by Orchestrator Agent with:**
```typescript
interface EducationInput {
  user_id: string;
  question_type: 'concept_explanation' | 'how_to_guide' | 'decision_help' | 'general_inquiry';
  topic_area?: 'budgeting' | 'investing' | 'taxes' | 'insurance' | 'planning' | 'debt';
  user_question: string;
  context: {
    user_message: string;
    detected_entities: any;
    session_state: SessionState;
    current_financial_context?: any;
  };
  learning_preferences?: {
    complexity_level?: 'beginner' | 'intermediate' | 'advanced';
    format_preference?: 'explanation' | 'examples' | 'step_by_step' | 'interactive';
    time_availability?: 'quick' | 'moderate' | 'comprehensive';
  };
}
```

**Educational Response Schema:**
```typescript
interface EducationResponse {
  success: boolean;
  agent: 'Educate_Customer_Agent';
  response_type: 'educational_content';
  content: {
    main_explanation: string;
    personalized_examples: PersonalizedExample[];
    key_takeaways: string[];
    action_steps?: string[];
    interactive_elements?: InteractiveElement[];
    related_topics: string[];
    progress_update: ProgressUpdate;
  };
  memory_updated: boolean;
  learning_path_updated: boolean;
}

interface PersonalizedExample {
  example_type: 'calculation' | 'scenario' | 'comparison' | 'case_study';
  description: string;
  user_specific_data: any;
  outcome_explanation: string;
}
```

### Financial Education Content Framework
[Source: financial literacy best practices and educational standards]
**Learning Progression Levels:**
```javascript
const educationLevels = {
  beginner: {
    topics: [
      'basic_budgeting',
      'emergency_fund_importance',
      'compound_interest_basics',
      'debt_vs_savings',
      'insurance_basics'
    ],
    approach: 'simple_explanations_with_analogies',
    examples: 'basic_scenarios_round_numbers'
  },
  intermediate: {
    topics: [
      'investment_diversification',
      'tax_advantaged_accounts',
      'risk_tolerance_assessment',
      'insurance_needs_analysis',
      'goal_based_planning'
    ],
    approach: 'detailed_analysis_with_comparisons',
    examples: 'realistic_scenarios_actual_numbers'
  },
  advanced: {
    topics: [
      'asset_allocation_optimization',
      'tax_loss_harvesting',
      'estate_planning_basics',
      'advanced_investment_strategies',
      'business_financial_planning'
    ],
    approach: 'strategic_analysis_with_nuances',
    examples: 'complex_scenarios_multiple_variables'
  }
};
```

### Memory Management Schema
**Educate Customer Agent Memory Topics:**
- **Short-term:** Query-specific examples, current educational session context
- **Long-term:** User education progress, preferred topics, knowledge mastery tracking

**Memory Update Structure:**
```json
{
  "agent_name": "Educate_Customer_Agent",
  "memory_type": "education_progress",
  "memory_content": {
    "knowledge_mastery": {
      "completed_topics": [
        {
          "topic": "compound_interest",
          "mastery_level": "intermediate",
          "completion_date": "2025-09-15",
          "quiz_score": 85,
          "practical_application": true
        }
      ],
      "current_focus_areas": ["investment_diversification", "tax_planning"],
      "knowledge_gaps": ["estate_planning", "business_planning"],
      "overall_literacy_level": "intermediate_progressing"
    },
    "learning_preferences": {
      "preferred_explanation_style": "examples_heavy|theory_focused|step_by_step",
      "optimal_session_length": "5_minutes|15_minutes|30_minutes",
      "best_learning_times": ["evening", "weekend_mornings"],
      "retention_method": "repetition|application|discussion"
    },
    "educational_interaction_history": [
      {
        "date": "2025-09-20",
        "topic": "investment_risk_assessment",
        "question_quality": "good_specific_question",
        "engagement_level": "high",
        "follow_up_questions": 3,
        "applied_learning": true
      }
    ]
  }
}
```

### Structured Output Parser Configuration
[Source: ai-agent-chat-api-workflow-example.md]
```json
{
  "schemaType": "manual",
  "inputSchema": {
    "type": "object",
    "properties": {
      "memory": {
        "type": "string",
        "description": "Memory updates for education agent: user education progress, preferred topics, knowledge mastery levels, learning interaction patterns"
      },
      "educationalContent": {
        "type": "object",
        "properties": {
          "main_explanation": {"type": "string"},
          "personalized_examples": {"type": "array"},
          "key_takeaways": {"type": "array"},
          "action_steps": {"type": "array"},
          "interactive_elements": {"type": "array"},
          "related_topics": {"type": "array"},
          "progress_summary": {"type": "string"}
        }
      }
    }
  }
}
```

### Personalized Educational Examples
[Source: adult learning theory and financial education best practices]
**Example Generation Based on User Profile:**
```javascript
// Compound interest example using user's actual savings goal
function generateCompoundInterestExample(userProfile) {
  const savingsGoal = userProfile.goals.emergency_fund.target_amount; // $15,000
  const monthlyContribution = userProfile.budget.savings_allocation; // $500
  const interestRate = 0.05; // 5% annual
  
  return `
    Let's use your emergency fund goal of $${savingsGoal} as an example:
    
    If you save $${monthlyContribution} monthly at 5% annual interest:
    - Year 1: $6,151 (vs $6,000 without interest)
    - Year 2: $12,614 (vs $12,000 without interest) 
    - Year 3: Your $15,000 goal reached with $614 bonus from compound interest!
    
    The "extra" $614 is your money working for you through compound interest.
  `;
}

// Risk tolerance example using user's current investments
function generateRiskToleranceExample(userProfile) {
  const currentPortfolio = userProfile.investments.current_allocation;
  return `
    Based on your current 60% stocks / 40% bonds portfolio:
    - Conservative (30% stocks): Lower volatility, ~6% average return
    - Your current (60% stocks): Moderate volatility, ~8% average return  
    - Aggressive (90% stocks): Higher volatility, ~10% average return
    
    Your current allocation suggests moderate risk tolerance, which aligns 
    with your 10-year investment timeline for retirement goals.
  `;
}
```

### Interactive Educational Elements
[Source: educational engagement best practices]
**Knowledge Check Activities:**
```javascript
// Scenario-based decision making
const scenarioQuiz = {
  question: "Your emergency fund has $3,000 but your car needs $2,000 in repairs. What's your best option?",
  options: [
    "Use credit card (18% APR) to preserve emergency fund",
    "Use $2,000 from emergency fund and rebuild it",  
    "Take a personal loan (12% APR) for repairs",
    "Delay repairs and save up first"
  ],
  correct_answer: 1,
  explanation: "Emergency funds are for true emergencies like necessary car repairs. Using it is better than high-interest debt, and you can rebuild it over time."
};

// Calculation practice
const calculationExercise = {
  scenario: "You want to save $10,000 in 18 months. How much should you save monthly?",
  user_input_required: true,
  correct_calculation: 10000 / 18,
  teaching_moment: "Always work backwards from your goal: Target Amount ÷ Time Period = Required Monthly Savings"
};
```

### Learning Path Progression Logic
[Source: competency-based education frameworks]
**Prerequisite Topic Dependencies:**
```javascript
const topicPrerequisites = {
  'investment_diversification': ['compound_interest', 'risk_basics'],
  'asset_allocation': ['investment_diversification', 'risk_tolerance'],
  'tax_optimization': ['investment_basics', 'retirement_accounts'],
  'estate_planning': ['insurance_basics', 'tax_optimization']
};

// Check if user is ready for advanced topic
function checkTopicReadiness(userProgress, requestedTopic) {
  const prerequisites = topicPrerequisites[requestedTopic] || [];
  const completedTopics = userProgress.completed_topics.map(t => t.topic);
  
  const missingPrereqs = prerequisites.filter(req => 
    !completedTopics.includes(req) || 
    userProgress.mastery_levels[req] < 'intermediate'
  );
  
  return {
    ready: missingPrereqs.length === 0,
    missing_prerequisites: missingPrereqs,
    suggested_next_steps: missingPrereqs.length > 0 ? 
      `Let's first cover ${missingPrereqs.join(', ')} before diving into ${requestedTopic}` : null
  };
}
```

### File Locations and Structure
[Source: architecture/unified-project-structure.md]
```
n8n-config/
├── workflows/
│   └── agents/
│       └── 10_educate_customer_agent.json (COMPLETED - 15-node workflow)
└── memory_update_agent.json (placeholder for memory management)
```

### Completion Notes
**Implementation Summary:**
- **Workflow Created:** `10_educate_customer_agent.json` - 15-node comprehensive financial education workflow
- **AI Integration:** Google Gemini Chat Model with specialized financial educator system prompt
- **Database Integration:** 5 PostgreSQL query tools accessing users, money_accounts, transactions, data_rows tables
- **Memory Management:** Integrated with MemoryUpdaterAgent for education progress and knowledge tracking
- **Structured Output:** Comprehensive schema for personalized educational content with progress tracking
- **Educational Features:** Adaptive learning, personalized examples, interactive elements, progress tracking

**Key Features Implemented:**
1. **Adaptive Learning System:** Content adjusts to beginner/intermediate/advanced knowledge levels based on user profile
2. **Personalized Examples:** Uses actual user financial data for relevant, contextual learning scenarios
3. **Comprehensive Topic Coverage:** Budgeting, investing, debt management, retirement, insurance, taxes
4. **Interactive Elements:** Knowledge checks, practical exercises, scenario-based learning, decision frameworks
5. **Progress Tracking:** Learning progression, prerequisite checking, spaced repetition, mastery assessment
6. **Memory Integration:** Education history, knowledge gaps, learning preferences, interaction patterns

**Testing Validation:**
- ✅ Workflow execution successful with proper input/output handling
- ✅ Database queries functioning correctly across all financial data tables
- ✅ AI agent generating contextually appropriate educational content
- ✅ Memory updates properly formatted and integrated with MemoryUpdaterAgent
- ✅ Structured output schema validated with comprehensive educational responses
- ✅ Personalized examples verified using user's actual financial situation

### Testing Requirements
- **Content Personalization:** Test educational content adaptation based on user profile and knowledge level
- **Learning Progression:** Test prerequisite checking and learning path recommendations
- **Knowledge Assessment:** Test quiz generation and progress tracking accuracy
- **Example Generation:** Test personalized example creation using user's financial data
- **Memory Management:** Test education progress tracking and preference learning
- **Engagement:** Test interactive element effectiveness and user engagement metrics

## Testing

### Test Coverage Requirements
**Educational Content:** Test content generation accuracy and personalization effectiveness
**Learning Progression:** Verify prerequisite checking and knowledge building logic
**Interactive Elements:** Test quiz generation and engagement feature functionality
**Progress Tracking:** Test education progress recording and mastery level assessment
**Personalization:** Test example generation using user's specific financial situation

### Test Cases
1. **Content Generation and Personalization Tests:**
   - Test educational content adaptation for different knowledge levels
   - Test personalized example generation using user's financial profile
   - Test topic complexity adjustment based on user understanding
   - Test learning style adaptation (visual, textual, interactive)

2. **Learning Progression and Knowledge Building Tests:**
   - Test prerequisite topic identification and sequencing
   - Test knowledge gap analysis and recommendation generation
   - Test progress tracking across multiple educational sessions
   - Test mastery level assessment and advancement criteria

3. **Interactive Element and Engagement Tests:**
   - Test quiz question generation and answer validation
   - Test scenario-based learning exercise creation
   - Test calculation practice problems and solution checking
   - Test user engagement tracking and optimization

4. **Memory and Progress Management Tests:**
   - Test education progress recording and retrieval accuracy
   - Test learning preference identification and application
   - Test knowledge retention tracking and spaced repetition scheduling
   - Test educational interaction pattern analysis and optimization

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-20 | 1.0 | Initial story creation for Educate Customer Agent implementation | Scrum Master |
| 2025-09-20 | 1.1 | **COMPLETED:** Full implementation of 15-node education workflow with AI agent, PostgreSQL integration, and comprehensive personalized financial education capabilities | James (Dev Agent) |
